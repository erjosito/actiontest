aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBvcwppbXBvcnQgYXJncGFyc2UKaW1wb3J0IHN5cwppbXBv
cnQganNvbgppbXBvcnQgdXVpZAoKIyBWYXJpYWJsZXMKdHJhbnNsYXRlX2tleXMgPSAoJ2Rlc2Ny
aXB0aW9uJywgJ25hbWUnLCAnY2F0ZWdvcnknLCAnc3ViY2F0ZWdvcnknLCAndGV4dCcpCnRyYW5z
bGF0ZV9sYW5ndWFnZXMgPSBbJ2VzJywgJ2phJywgJ3B0JywgJ2tvJ10KCiMgR2V0IGVudmlyb25t
ZW50IHZhcmlhYmxlcwp0cmFuc2xhdG9yX2VuZHBvaW50ID0gb3MuZW52aXJvblsiQVpVUkVfVFJB
TlNMQVRPUl9FTkRQT0lOVCJdCnRyYW5zbGF0b3JfcmVnaW9uID0gb3MuZW52aXJvblsiQVpVUkVf
VFJBTlNMQVRPUl9SRUdJT04iXQp0cmFuc2xhdG9yX2tleSA9IG9zLmVudmlyb25bIkFaVVJFX1RS
QU5TTEFUT1JfU1VCU0NSSVBUSU9OX0tFWSJdCnRyYW5zbGF0b3JfdXJsID0gdHJhbnNsYXRvcl9l
bmRwb2ludCArICd0cmFuc2xhdGUnCgojIEdldCBpbnB1dCBhcmd1bWVudHMKcGFyc2VyID0gYXJn
cGFyc2UuQXJndW1lbnRQYXJzZXIoZGVzY3JpcHRpb249J1RyYW5zbGF0ZSBhIEpTT04gZmlsZScp
CnBhcnNlci5hZGRfYXJndW1lbnQoJy0taW5wdXQtZmlsZS1uYW1lJywgZGVzdD0nZmlsZV9uYW1l
X2luJywgYWN0aW9uPSdzdG9yZScsCiAgICAgICAgICAgICAgICAgICAgaGVscD0neW91IG5lZWQg
dG8gc3VwcGx5IGZpbGUgbmFtZSB3aGVyZSB5b3VyIEpTT04gdG8gYmUgdHJhbnNsYXRlZCBpcyBs
b2NhdGVkJykKcGFyc2VyLmFkZF9hcmd1bWVudCgnLS1vdXRwdXQtZmlsZS1uYW1lJywgZGVzdD0n
ZmlsZV9uYW1lX291dCcsIGFjdGlvbj0nc3RvcmUnLAogICAgICAgICAgICAgICAgICAgIGhlbHA9
J3lvdSBuZWVkIHRvIHN1cHBseSBmaWxlIG5hbWUgd2hlcmUgdGhlIHRyYW5zbGF0ZWQgSlNPTiB3
aWxsIGJlIHNhdmVkJykKcGFyc2VyLmFkZF9hcmd1bWVudCgnLS12ZXJib3NlJywgZGVzdD0ndmVy
Ym9zZScsIGFjdGlvbj0nc3RvcmVfdHJ1ZScsCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdD1G
YWxzZSwKICAgICAgICAgICAgICAgICAgICBoZWxwPSdydW4gaW4gdmVyYm9zZSBtb2RlIChkZWZh
dWx0OiBGYWxzZSknKQphcmdzID0gcGFyc2VyLnBhcnNlX2FyZ3MoKQoKIyBDaGVjayB3ZSBoYXZl
IGFsbCBpbmZvcm1hdGlvbgppZiB0cmFuc2xhdG9yX2VuZHBvaW50IGFuZCB0cmFuc2xhdG9yX3Jl
Z2lvbiBhbmQgdHJhbnNsYXRvcl9rZXk6CiAgICBpZiBhcmdzLnZlcmJvc2U6CiAgICAgICAgcHJp
bnQoJ0RFQlVHOiBlbnZpcm9ubWVudCB2YXJpYWJsZXMgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseTog
ezB9LCB7MX0sIHsyfScuZm9ybWF0KHRyYW5zbGF0b3JfZW5kcG9pbnQsIHRyYW5zbGF0b3JfcmVn
aW9uLCB0cmFuc2xhdG9yX2tleSkpCmVsc2U6CiAgICBwcmludCgnRVJST1I6IGNvdWxkbnQgcmV0
cmlldmUgZW52aXJvbm1lbnQgdmFyaWFibGVzIGZvciB0cmFuc2xhdGlvbicpCiAgICBzeXMuZXhp
dCgxKQoKIyBHZXQgSlNPTgp0cnk6CiAgICB3aXRoIG9wZW4oYXJncy5maWxlX25hbWVfaW4pIGFz
IGY6CiAgICAgICAgY2hlY2tsaXN0ID0ganNvbi5sb2FkKGYpCmV4Y2VwdCBFeGNlcHRpb24gYXMg
ZToKICAgIHByaW50KCJFUlJPUjogRXJyb3Igd2hlbiBwcm9jZXNzaW5nIEpTT04gZmlsZSIsIGFy
Z3MuZmlsZV9uYW1lX2luLCAiLSIsIHN0cihlKSkKICAgIHN5cy5leGl0KDEpCgojIEZ1bmN0aW9u
IHRvIHRyYW5zbGF0ZSBhIHNpbmdsZSBsaW5lIG9mIHRleHQgdG8gYSBzaW5nbGUgbGFuZ3VhZ2UK
ZGVmIHRyYW5zbGF0ZV90ZXh0KHRleHRfdG9fdHJhbnNsYXRlLCBsYW5ndWFnZXMpOgogICAgaWYg
YXJncy52ZXJib3NlOgogICAgICAgIHByaW50KCdERUJVRzogdHJhbnNsYXRpbmcgdGV4dCAiezB9
IiBvbiB7MX0uLi4nLmZvcm1hdCh0ZXh0X3RvX3RyYW5zbGF0ZSwgdHJhbnNsYXRvcl91cmwpKQog
ICAgIyBJZiBhIHNpbmdsZSBsYW5ndWFnZXMgc3BlY2lmaWVkLCBjb252ZXJ0IHRvIGFycmF5CiAg
ICBpZiBub3QgdHlwZShsYW5ndWFnZXMpID09IGxpc3Q6CiAgICAgICAgbGFuZ3VhZ2VzID0gW2xh
bmd1YWdlc10KICAgICMgQXp1cmUgVHJhbnNsYXRvciBwYXJhbWV0ZXJzCiAgICB0cmFuc2xhdG9y
X3BhcmFtcyA9IHsKICAgICAgICAnYXBpLXZlcnNpb24nOiAnMy4wJywKICAgICAgICAnZnJvbSc6
ICdlbicsCiAgICAgICAgJ3RvJzogbGFuZ3VhZ2VzCiAgICB9CiAgICB0cmFuc2xhdG9yX2hlYWRl
cnMgPSB7CiAgICAgICAgJ09jcC1BcGltLVN1YnNjcmlwdGlvbi1LZXknOiB0cmFuc2xhdG9yX2tl
eSwKICAgICAgICAnT2NwLUFwaW0tU3Vic2NyaXB0aW9uLVJlZ2lvbic6IHRyYW5zbGF0b3JfcmVn
aW9uLAogICAgICAgICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAg
J0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAnWC1DbGllbnRUcmFjZUlkJzog
c3RyKHV1aWQudXVpZDQoKSkKICAgIH0KICAgIHRyYW5zbGF0b3JfYm9keSA9IFt7CiAgICAgICAg
J3RleHQnOiB0ZXh0X3RvX3RyYW5zbGF0ZQogICAgfV0KICAgIGlmIGFyZ3MudmVyYm9zZToKICAg
ICAgICBwcmludCAoIkRFQlVHOiBzZW5kaW5nIGJvZHkiLCBzdHIodHJhbnNsYXRvcl9ib2R5KSkK
ICAgICAgICBwcmludCAoIkRFQlVHOiBzZW5kaW5nIEhUVFAgaGVhZGVycyIsIHN0cih0cmFuc2xh
dG9yX2hlYWRlcnMpKQogICAgICAgIHByaW50ICgiREVCVUc6IHNlbmRpbmcgcGFyYW1ldGVycyIs
IHN0cih0cmFuc2xhdG9yX3BhcmFtcykpCiAgICB0cnk6CiAgICAgICAgcmVxdWVzdCA9IHJlcXVl
c3RzLnBvc3QodHJhbnNsYXRvcl91cmwsIHBhcmFtcz10cmFuc2xhdG9yX3BhcmFtcywgaGVhZGVy
cz10cmFuc2xhdG9yX2hlYWRlcnMsIGpzb249dHJhbnNsYXRvcl9ib2R5KQogICAgICAgIHJlc3Bv
bnNlID0gcmVxdWVzdC5qc29uKCkKICAgICAgICBpZiBhcmdzLnZlcmJvc2U6CiAgICAgICAgICAg
IHByaW50KCJERUJVRzogdHJhbnNsYXRvciByZXNwb25zZToiKQogICAgICAgICAgICBwcmludChq
c29uLmR1bXBzKHJlc3BvbnNlLCBzb3J0X2tleXM9VHJ1ZSwgZW5zdXJlX2FzY2lpPUZhbHNlLCBp
bmRlbnQ9NCwgc2VwYXJhdG9ycz0oJywnLCAnOiAnKSkpCiAgICAgICAgcmV0dXJuIHN0cihyZXNw
b25zZVswXVsndHJhbnNsYXRpb25zJ11bMF1bJ3RleHQnXSkKICAgIGV4Y2VwdCBFeGNlcHRpb24g
YXMgZToKICAgICAgICBwcmludCgiRVJST1I6IEVycm9yIGluIHRyYW5zbGF0aW9uOiIsIHN0cihl
KSkKCiMgR28gb3ZlciBhbGwga2V5cyBhbmQgdHJhbnNsYXRlIHRoZW0gaWYgcmVxdWlyZWQKZGVm
IHRyYW5zbGF0ZV9vYmplY3QoY2hlY2tsaXN0X29iamVjdCwgbGFuZ3VhZ2UpOgogICAgdHJhbnNs
YXRlZF9vYmplY3QgPSBjaGVja2xpc3Rfb2JqZWN0LmNvcHkoKQogICAgZm9yIChrLCB2KSBpbiB0
cmFuc2xhdGVkX29iamVjdC5pdGVtcygpOgogICAgICAgIGlmIGlzaW5zdGFuY2UodiwgbGlzdCk6
CiAgICAgICAgICAgIHRyYW5zbGF0ZWRfaXRlbXMgPSAoKQogICAgICAgICAgICBmb3IgbGlzdF9p
dGVtIGluIHY6CiAgICAgICAgICAgICAgICB0cmFuc2xhdGVkX2l0ZW1zLmFwcGVuZCh0cmFuc2xh
dGVfb2JqZWN0KGxpc3RfaXRlbSwgbGFuZ3VhZ2UpKQogICAgICAgICAgICB0cmFuc2xhdGVkX29i
amVjdFtrXSA9IHRyYW5zbGF0ZWRfaXRlbXMKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBr
IGluIHRyYW5zbGF0ZV9rZXlzOgogICAgICAgICAgICAgICAgIyBwcmludCgiRm91bmQga2V5Iiwg
aywgImFuZCBzY2FsYXIgdmFsdWUiLCB2KQogICAgICAgICAgICAgICAgdHJhbnNsYXRlZF9vYmpl
Y3Rba10gPSB0cmFuc2xhdGVfdGV4dCh2LCBsYW5ndWFnZSkKICAgIHJldHVybiB0cmFuc2xhdGVk
X29iamVjdAoKIyMjIyMjIyMjIyMjIyMjIwojICAgICBNYWluICAgICAjCiMjIyMjIyMjIyMjIyMj
IyMKCmlmIGFyZ3MudmVyYm9zZToKICAgIHByaW50KCJERUJVRzogU3RhcnRpbmcgdHJhbnNsYXRp
b25zIGZvciBsYW5ndWFnZXMiLCBzdHIodHJhbnNsYXRlX2xhbmd1YWdlcykpCgpmb3IgdXNpbmdf
bGFuZ3VhZ2UgaW4gdHJhbnNsYXRlX2xhbmd1YWdlczoKICAgIGlmIGFyZ3MudmVyYm9zZToKICAg
ICAgICBwcmludCgiREVCVUc6IFN0YXJ0aW5nIHRyYW5zbGF0aW9uIHRvIiwgdXNpbmdfbGFuZ3Vh
Z2UpCiAgICB0cmFuc2xhdGVkX2NoZWNrbGlzdCA9IHRyYW5zbGF0ZV9vYmplY3QoY2hlY2tsaXN0
LCB1c2luZ19sYW5ndWFnZSkKICAgICMgSWYgbm8gb3V0cHV0IGZpbGUgd2FzIHNwZWNpZmllZCwg
dXNlIHRoZSBpbnB1dCBmaWxlLCBhbmQgYXBwZW5kIHRoZSBsYW5ndWFnZSBhcyBleHRlbnNpb24g
YmVmb3JlIC5qc29uCiAgICBpZiBub3QgYXJncy5maWxlX25hbWVfb3V0OgogICAgICAgIGZpbGVf
bmFtZV9pbl9iYXNlID0gb3MucGF0aC5iYXNlbmFtZShhcmdzLmZpbGVfbmFtZV9pbikKICAgICAg
ICBmaWxlX25hbWVfaW5fZGlyID0gb3MucGF0aC5kaXJuYW1lKGFyZ3MuZmlsZV9uYW1lX2luKQog
ICAgICAgIGZpbGVfbmFtZV9pbl9ub2V4dCA9IGZpbGVfbmFtZV9pbl9iYXNlLnNwbGl0KCcuJylb
MF0KICAgICAgICBmaWxlX25hbWVfb3V0ID0gZmlsZV9uYW1lX2luX25vZXh0ICsgJy4nICsgdXNp
bmdfbGFuZ3VhZ2UgKyAnLmpzb24nCiAgICAgICAgZmlsZV9uYW1lX291dCA9IG9zLnBhdGguam9p
bihmaWxlX25hbWVfaW5fZGlyLCBmaWxlX25hbWVfb3V0KQogICAgICAgIGlmIGFyZ3MudmVyYm9z
ZToKICAgICAgICAgICAgcHJpbnQoIkRFQlVHOiBzYXZpbmcgb3V0cHV0IGZpbGUgdG8iLCBmaWxl
X25hbWVfb3V0KQogICAgICAgIHRyYW5zbGF0ZWRfY2hlY2tsaXN0X3N0cmluZyA9IGpzb24uZHVt
cHModHJhbnNsYXRlZF9jaGVja2xpc3QsIHNvcnRfa2V5cz1UcnVlLCBlbnN1cmVfYXNjaWk9RmFs
c2UsIGluZGVudD00LCBzZXBhcmF0b3JzPSgnLCcsICc6ICcpKQogICAgICAgIHdpdGggb3Blbihm
aWxlX25hbWVfb3V0LCAndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgIGYu
d3JpdGUodHJhbnNsYXRlZF9jaGVja2xpc3Rfc3RyaW5nKQogICAgICAgICAgICBmLmNsb3NlKCkK
ICAgICAgICAjIHByaW50KGpzb24uZHVtcHModHJhbnNsYXRlZF9jaGVja2xpc3QsIHNvcnRfa2V5
cz1UcnVlLCBlbnN1cmVfYXNjaWk9RmFsc2UsIGluZGVudD00LCBzZXBhcmF0b3JzPSgnLCcsICc6
ICcpKSkK
